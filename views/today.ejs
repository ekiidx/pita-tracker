<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pita Tracker</title>
    <link href="/assets/css/main.css" rel="stylesheet" />
</head>

<body>
    <div class="header"><a href="/"><img class="cat-logo" src="/assets/img/cat-run.gif"></a><h1>Pita Tracker 1.0</h1></div>
    
    <div><canvas id="bloodChart"></canvas></div>
    <div><canvas id="insulinChart"></canvas></div>
    <div><canvas id="foodChart"></canvas></div>
    <!-- Blood Modal -->
    <div id="bloodModal" class="modal">
        <div class="modal-content">
            <form action="/blood" method="POST">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
                <label for="time">Time of Measurement</label>
                <input type="time" id="time" name="time" required>
                <label for="blood">Blood Glucose (mg/dL)</label>
                <input type="number" id="blood" name="blood" min="0" required>
                <label for="temp">Temperature (F)</label>
                <input type="number" id="temp" name="temp" min="0" required>
                <button type="submit">Submit</button>
                <button type="button" onclick="closeBloodModal()">Cancel</button>
            </form>
        </div>
    </div>
    <!-- Insulin Modal -->
    <div id="insulinModal" class="modal">
        <div class="modal-content">
            <form action="/insulin" method="POST">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
                <label for="time">Time of Measurement</label>
                <input type="time" id="time" name="time" required>
                <label for="insulin">Insulin Dose (units)</label>
                <input type="number" step="0.1" id="insulin" name="insulin">
                <button type="submit">Submit</button>
                <button type="button" onclick="closeInsulinModal()">Cancel</button>
            </form>
        </div>
    </div>
    <!-- Food Modal -->
    <div id="foodModal" class="modal">
        <div class="modal-content">
            <form action="/food" method="POST">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
                <label for="time">Time of Measurement</label>
                <input type="time" id="time" name="time" required>
                <label for="food">Food Amount (in cups)</label>
                <input type="number" id="food" name="food" min="0" step="0.25" required>
                <button type="submit">Submit</button>
                <button type="button" onclick="closeFoodModal()">Cancel</button>
            </form>
        </div>
    </div>

   <div class="main-content">
        <div class="entries bg-white">
            <div class="entries-header"> 
                <a href="/back"><img class="arrow-left" src="/assets/img/arrow.png"></a>
                <h2>Today's Entries</h2>
                <img class="arrow-right" src="/assets/img/arrow.png">
            </div>
        
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="data-body"></tbody>
            </table>
        </div>

        <div class="graph-content">
            <canvas id="bloodChartToday"></canvas>
        </div>
    </div>

    <% blood.forEach(item => { %>
        <div><%= item.date %></div>
    <% }) %>

     <% insulin.forEach(item => { %>
        <div><%= item.insulin %></div>
    <% }) %>

     <% food.forEach(item => { %>
        <div><%= item.food %></div>
    <% }) %>

   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script>
      fetch('/api/entries/today')
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('data-body');

                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                 <td>${row.source}</td>
                 <td>${row.date}</td>
                 <td>${row.time}</td>
                 <td>${row.blood}</td>
               `;
                    tbody.appendChild(tr);

                });
            })
            .catch(err => {
                console.error('Error fetching data:', err);
        });
    </script>
    <script src="/assets/js/chartjs.min.js"></script>
    <script src="/assets/js/chartjs-adapter-date-fns.min.js"></script>
</body>
</html>